# ã¯ã˜ã‚€ å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–‹ç™ºã‚¬ã‚¤ãƒ‰

> ğŸ‡ºğŸ‡¸ **English version available:** [PLUGIN_DEVELOPMENT.md](PLUGIN_DEVELOPMENT.md)

ã¯ã˜ã‚€è¨€èªã®å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆç´” jp ã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ»C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼‰ã‚’é–‹ç™ºãƒ»å…¬é–‹ã™ã‚‹ãŸã‚ã®æ‰‹å¼•ãã§ã™ã€‚

---

## ç›®æ¬¡

1. [ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¨®é¡](#ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¨®é¡)
2. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ)
3. [hajimu.json ã®æ›¸ãæ–¹](#hajimujson-ã®æ›¸ãæ–¹)
4. [jp ã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](#jp-ã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸)
5. [C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆ.hjpï¼‰](#c-æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³hjp)
6. [å€¤å‹ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#å€¤å‹ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹)
7. [ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ãƒ“ãƒ«ãƒ‰](#ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ãƒ“ãƒ«ãƒ‰)
8. [Makefile ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](#makefile-ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)
9. [ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬é–‹](#ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬é–‹)
10. [ãƒ‡ãƒãƒƒã‚°ã¨ãƒ†ã‚¹ãƒˆ](#ãƒ‡ãƒãƒƒã‚°ã¨ãƒ†ã‚¹ãƒˆ)
11. [ã‚ˆãã‚ã‚‹è³ªå•](#ã‚ˆãã‚ã‚‹è³ªå•)

---

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¨®é¡

ã¯ã˜ã‚€ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ 2 ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

| ç¨®é¡ | æ‹¡å¼µå­ | ç‰¹å¾´ |
|---|---|---|
| **jp ã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** | `.jp` | ã¯ã˜ã‚€è¨€èªã§è¨˜è¿°ã€‚ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ãŒãã®ã¾ã¾å®Ÿè¡Œ |
| **C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³** | `.hjp` | C/C++ ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸå…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚é«˜é€Ÿå‡¦ç†ãƒ»ãƒã‚¤ãƒ†ã‚£ãƒ– API ã«æœ€é© |

> **æ³¨æ„**: `.hjp` ã¯å†…éƒ¨çš„ã«å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆmacOS: `.dylib`ã€Linux: `.so`ã€Windows: `.dll`ï¼‰ã¨åŒã˜å½¢å¼ã§ã™ãŒã€æ‹¡å¼µå­ã‚’çµ±ä¸€ã™ã‚‹ã“ã¨ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ OS ã®é•ã„ã‚’æ„è­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
my_package/              â† ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ= GitHub ãƒªãƒã‚¸ãƒˆãƒªåï¼‰
  hajimu.json            â† ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆï¼ˆå¿…é ˆï¼‰
  README.md
  LICENSE
  Makefile               â† C æ‹¡å¼µã®å ´åˆï¼ˆæ¨å¥¨ï¼‰
  src/
    my_plugin.c          â† C æ‹¡å¼µã®ã‚½ãƒ¼ã‚¹
  include/
    my_plugin.h
  dist/                  â† ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ .hjp ã®é…ç½®å…ˆï¼ˆæ¨å¥¨åï¼‰
    my_package-macos.hjp
    my_package-linux-x64.hjp
    my_package-windows-x64.hjp
  examples/
    sample.jp
```

jp ã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å ´åˆ:

```
my_package/
  hajimu.json
  README.md
  main.jp                â† ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆï¼ˆhajimu.json ã® "ãƒ¡ã‚¤ãƒ³" ã§æŒ‡å®šï¼‰
  utils.jp
  examples/
    sample.jp
```

---

## hajimu.json ã®æ›¸ãæ–¹

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒˆã« `hajimu.json` ã‚’ç½®ãã¾ã™ã€‚

```json
{
  "åå‰": "my_package",
  "ãƒãƒ¼ã‚¸ãƒ§ãƒ³": "1.0.0",
  "èª¬æ˜": "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ¦‚è¦",
  "ä½œè€…": "ä½œè€…å",
  "ãƒ¡ã‚¤ãƒ³": "main.jp",
  "ä¾å­˜": {
    "other_package": "https://github.com/username/other_package"
  }
}
```

### C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å ´åˆ

```json
{
  "åå‰": "my_plugin",
  "ãƒãƒ¼ã‚¸ãƒ§ãƒ³": "1.0.0",
  "èª¬æ˜": "C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä¾‹",
  "ä½œè€…": "ä½œè€…å",
  "ãƒ¡ã‚¤ãƒ³": "dist/my_plugin.hjp",
  "ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰": "make build-all"
}
```

> `"ãƒ¡ã‚¤ãƒ³"` ã« `.hjp` ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚ã¯ã˜ã‚€ã¯ OS ã«å¿œã˜ã¦ `my_plugin-macos.hjp` / `my_plugin-linux-x64.hjp` / `my_plugin-windows-x64.hjp` ã‚’è‡ªå‹•ã§é¸æŠã—ã¾ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚

---

## jp ã‚½ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

### ä½œæˆä¾‹

`main.jp`:

```jp
// å…¬é–‹ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã ã‘

é–¢æ•° æŒ¨æ‹¶(åå‰) {
  è¿”ã™ "ã“ã‚“ã«ã¡ã¯ã€" + åå‰ + "ï¼"
}

é–¢æ•° è¶³ã™(å€¤1, å€¤2) {
  è¿”ã™ å€¤1 + å€¤2
}
```

### ä½¿ç”¨æ–¹æ³•ï¼ˆåˆ©ç”¨è€…å´ï¼‰

```jp
å–ã‚Šè¾¼ã‚€ "my_package" ã¨ã—ã¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

è¡¨ç¤º(ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸["æŒ¨æ‹¶"]("ä¸–ç•Œ"))  // â†’ ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œï¼
è¡¨ç¤º(ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸["è¶³ã™"](3, 4))    // â†’ 7
```

---

## C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆ.hjpï¼‰

### æœ€å°å®Ÿè£…ä¾‹

```c
#include "hajimu_plugin.h"

/* ã¯ã˜ã‚€ã‹ã‚‰å‘¼ã°ã‚Œã‚‹é–¢æ•° */
static Value äºŒä¹—(int argc, Value *argv) {
    double x = argv[0].number;
    return hajimu_number(x * x);
}

/* æ–‡å­—åˆ—ã‚’å¤§æ–‡å­—ã«å¤‰æ›ã™ã‚‹ä¾‹ */
static Value å«ã¶(int argc, Value *argv) {
    const char *s = argv[0].string.data;
    char buf[1024];
    snprintf(buf, sizeof(buf), "%sï¼ï¼ï¼", s);
    return hajimu_string(buf);
}

/* é–¢æ•°ãƒ†ãƒ¼ãƒ–ãƒ« */
static HajimuPluginFunc functions[] = {
    {"äºŒä¹—",   äºŒä¹—,  1, 1},   /* å¼•æ•° 1 å€‹å›ºå®š */
    {"å«ã¶",   å«ã¶,  1, 1},
};

/* åˆæœŸåŒ–é–¢æ•°ï¼ˆå¿…é ˆãƒ»åå‰å³å®ˆï¼‰ */
HAJIMU_PLUGIN_EXPORT HajimuPluginInfo *hajimu_plugin_init(void) {
    static HajimuPluginInfo info = {
        .name          = "my_plugin",
        .version       = "1.0.0",
        .author        = "ä½œè€…å",
        .description   = "ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³",
        .functions     = functions,
        .function_count = 2,
    };
    return &info;
}
```

### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰

```bash
# macOS
gcc -shared -fPIC -O2 \
    -I/path/to/jp/include \
    my_plugin.c -o dist/my_plugin-macos.hjp

# Linux
gcc -shared -fPIC -O2 \
    -I/path/to/jp/include \
    my_plugin.c -o dist/my_plugin-linux-x64.hjp -lm

# Windows (MinGW)
x86_64-w64-mingw32-gcc -shared -O2 \
    -I/path/to/jp/include \
    my_plugin.c -o dist/my_plugin-windows-x64.hjp
```

---

## å€¤å‹ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

`hajimu_plugin.h` ã§æä¾›ã•ã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã¨å‹ã€‚

### å€¤ã®ä½œæˆ

| é–¢æ•° | èª¬æ˜ | ä¾‹ |
|---|---|---|
| `hajimu_null()` | ç„¡å€¤ã‚’è¿”ã™ | `return hajimu_null();` |
| `hajimu_number(double n)` | æ•°å€¤ã‚’è¿”ã™ | `return hajimu_number(3.14);` |
| `hajimu_bool(bool b)` | çœŸå½å€¤ã‚’è¿”ã™ | `return hajimu_bool(true);` |
| `hajimu_string(const char *s)` | æ–‡å­—åˆ—ã‚’è¿”ã™ | `return hajimu_string("hello");` |

### å€¤ã®å‚ç…§

```c
static Value å‡¦ç†(int argc, Value *argv) {
    // å‹ç¢ºèª
    if (argv[0].type != VALUE_NUMBER) return hajimu_null();

    double n   = argv[0].number;           // æ•°å€¤
    bool   b   = argv[0].boolean;          // çœŸå½å€¤
    char  *s   = argv[0].string.data;      // æ–‡å­—åˆ—
    int    len = argv[0].string.length;    // æ–‡å­—åˆ—é•·

    // é…åˆ—è¦ç´ 
    for (int i = 0; i < argv[0].array.length; i++) {
        Value elem = argv[0].array.elements[i];
    }

    // è¾æ›¸
    Value val = dict_get(&argv[0], "ã‚­ãƒ¼");

    return hajimu_number(n * 2);
}
```

### å‹åˆ¤å®šãƒã‚¯ãƒ­

| å‹ | ValueType å®šæ•° |
|---|---|
| ç„¡ | `VALUE_NULL` |
| æ•°å€¤ | `VALUE_NUMBER` |
| çœŸå½ | `VALUE_BOOL` |
| æ–‡å­—åˆ— | `VALUE_STRING` |
| é…åˆ— | `VALUE_ARRAY` |
| è¾æ›¸ | `VALUE_DICT` |

### `HajimuPluginFunc` æ§‹é€ ä½“

```c
typedef struct {
    const char     *name;      // ã¯ã˜ã‚€å´ã«å…¬é–‹ã™ã‚‹é–¢æ•°åï¼ˆæ—¥æœ¬èª OKï¼‰
    HajimuPluginFn  fn;        // é–¢æ•°ãƒã‚¤ãƒ³ã‚¿
    int             min_args;  // æœ€å°å¼•æ•°æ•°
    int             max_args;  // æœ€å¤§å¼•æ•°æ•°ï¼ˆ-1 ã§å¯å¤‰é•·ï¼‰
} HajimuPluginFunc;
```

---

## ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ãƒ“ãƒ«ãƒ‰

### ãƒ•ã‚¡ã‚¤ãƒ«åè¦å‰‡

ã¯ã˜ã‚€ã¯ `å–ã‚Šè¾¼ã‚€ "my_plugin"` ã‚’å®Ÿè¡Œã—ãŸéš›ã€ä»¥ä¸‹ã®é †åºã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã¾ã™ã€‚

1. `my_plugin-<ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹>.hjp`ï¼ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ï¼‰
2. `my_plugin.hjp`ï¼ˆæ±ç”¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

| OS | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ | ãƒ•ã‚¡ã‚¤ãƒ«åä¾‹ |
|---|---|---|---|
| macOS | Apple Silicon (arm64) | `-macos-arm64` | `my_plugin-macos-arm64.hjp` |
| macOS | Intel (x86-64) | `-macos` | `my_plugin-macos.hjp` |
| Linux | x86-64 | `-linux-x64` | `my_plugin-linux-x64.hjp` |
| Linux | ARM64 | `-linux-arm64` | `my_plugin-linux-arm64.hjp` |
| Windows | x86-64 | `-windows-x64` | `my_plugin-windows-x64.hjp` |
| Windows | ARM64 | `-windows-arm64` | `my_plugin-windows-arm64.hjp` |

> **æ¨å¥¨**: `dist/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã® `.hjp` ã‚’ç½®ãã€`hajimu.json` ã® `"ãƒ¡ã‚¤ãƒ³"` ã‚’ `"dist/my_plugin.hjp"` ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚ã¯ã˜ã‚€ãŒè‡ªå‹•çš„ã«æ­£ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚

### hajimu_plugin.h ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒã‚¯ãƒ­

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ C ã‚½ãƒ¼ã‚¹å†…ã§ OSãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’åˆ†å²ã§ãã¾ã™ã€‚

```c
#include "hajimu_plugin.h"

static Value æƒ…å ±å–å¾—(int argc, Value *argv) {
#if defined(HAJIMU_OS_MACOS)
    return hajimu_string("macOS ã§å‹•ä½œä¸­");
#elif defined(HAJIMU_OS_LINUX)
    return hajimu_string("Linux ã§å‹•ä½œä¸­");
#elif defined(HAJIMU_OS_WINDOWS)
    return hajimu_string("Windows ã§å‹•ä½œä¸­");
#else
    return hajimu_string("ä¸æ˜ãª OS");
#endif
}
```

| ãƒã‚¯ãƒ­ | æ„å‘³ |
|---|---|
| `HAJIMU_OS_MACOS` | macOS |
| `HAJIMU_OS_LINUX` | Linux |
| `HAJIMU_OS_WINDOWS` | Windows |
| `HAJIMU_OS_NAME` | OS åã®æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ« |
| `HAJIMU_ARCH_ARM64` | ARM64 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ |
| `HAJIMU_ARCH_X64` | x86-64 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ |
| `HAJIMU_ARCH_NAME` | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åã®æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ« |
| `HAJIMU_HJP_SUFFIX` | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹æ–‡å­—åˆ—ï¼ˆ`-linux-x64` ãªã©ï¼‰ |

---

## Makefile ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰ç”¨ã® Makefile ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚

```makefile
# =============================================================================
# my_plugin â€” ã¯ã˜ã‚€è¨€èªç”¨ C æ‹¡å¼µãƒ—ãƒ©ã‚°ã‚¤ãƒ³
# =============================================================================
PLUGIN_NAME = my_plugin
DIST        = dist
SRCS        = src/my_plugin.c

# jp/include ã®è‡ªå‹•æ¤œç´¢ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ or ã‚½ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªï¼‰
HAJIMU_INC  = $(abspath $(firstword $(wildcard \
    ../../jp/include \
    ../jp/include \
    $(HOME)/.hajimu/include \
)))

# ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©
LINUX_CC   ?= x86_64-linux-musl-gcc
WIN_CC     ?= x86_64-w64-mingw32-gcc

.PHONY: build-all build-macos build-linux build-windows

build-all: build-macos build-linux build-windows
	@echo "  å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ãƒ«ãƒ‰å®Œäº†: $(DIST)/"

build-macos:
	@mkdir -p $(DIST)
	cc -shared -fPIC -O2 -std=c11 \
	  -I$(HAJIMU_INC) -Iinclude \
	  $(SRCS) \
	  -o $(DIST)/$(PLUGIN_NAME)-macos.hjp
	@echo "  macOS: $(DIST)/$(PLUGIN_NAME)-macos.hjp"

build-linux:
	@mkdir -p $(DIST)
	$(LINUX_CC) -shared -fPIC -O2 -std=gnu11 \
	  -I$(HAJIMU_INC) -Iinclude \
	  $(SRCS) \
	  -Wl,--allow-shlib-undefined \
	  -o $(DIST)/$(PLUGIN_NAME)-linux-x64.hjp
	@echo "  Linux: $(DIST)/$(PLUGIN_NAME)-linux-x64.hjp"

build-windows:
	@mkdir -p $(DIST)
	$(WIN_CC) -shared -O2 -std=gnu11 \
	  -D_WIN32_WINNT=0x0601 -DWIN32_LEAN_AND_MEAN \
	  -I$(HAJIMU_INC) -Iinclude \
	  $(SRCS) \
	  -static-libgcc \
	  -o $(DIST)/$(PLUGIN_NAME)-windows-x64.hjp
	@echo "  Windows: $(DIST)/$(PLUGIN_NAME)-windows-x64.hjp"

clean:
	rm -rf $(DIST)
```

### ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOS ä¸Šï¼‰

macOS ä¸€å°ã‹ã‚‰å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å‘ã‘ã«å‡ºåŠ›ã§ãã¾ã™ã€‚

```bash
# Linux å‘ã‘ï¼ˆmusl libcã€é™çš„ï¼‰
brew install FiloSottile/musl-cross/musl-cross

# Windows å‘ã‘ï¼ˆMinGW-w64ï¼‰
brew install mingw-w64
```

---

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬é–‹

### 1. GitHub ãƒªãƒã‚¸ãƒˆãƒªã« push

```bash
git init
git add .
git commit -m "initial release"
git remote add origin https://github.com/username/my_package
git push -u origin main
```

### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

åˆ©ç”¨è€…ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§:

```bash
# URL ã‚’æŒ‡å®šã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
nihongo install https://github.com/username/my_package

# ã¾ãŸã¯ hajimu.json ã«è¿½è¨˜ã—ã¦ã‹ã‚‰
nihongo install
```

`hajimu.json`ï¼ˆåˆ©ç”¨è€…å´ï¼‰:

```json
{
  "åå‰": "my_project",
  "ä¾å­˜": {
    "my_package": "https://github.com/username/my_package"
  }
}
```

### 3. ä½¿ç”¨æ–¹æ³•ï¼ˆåˆ©ç”¨è€…ã® jp ã‚³ãƒ¼ãƒ‰ï¼‰

```jp
å–ã‚Šè¾¼ã‚€ "my_package" ã¨ã—ã¦ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

å¤‰æ•° çµæœ = ãƒ—ãƒ©ã‚°ã‚¤ãƒ³["äºŒä¹—"](5)
è¡¨ç¤º(çµæœ)  // â†’ 25
```

---

## ãƒ‡ãƒãƒƒã‚°ã¨ãƒ†ã‚¹ãƒˆ

### ã¯ã˜ã‚€ã‹ã‚‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç›´æ¥ãƒ†ã‚¹ãƒˆ

```jp
å–ã‚Šè¾¼ã‚€ "./dist/my_plugin-macos.hjp" ã¨ã—ã¦ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

ãƒ†ã‚¹ãƒˆ("äºŒä¹—ã®ãƒ†ã‚¹ãƒˆ", é–¢æ•°() {
  æœŸå¾…(ãƒ—ãƒ©ã‚°ã‚¤ãƒ³["äºŒä¹—"](4), 16)
  æœŸå¾…(ãƒ—ãƒ©ã‚°ã‚¤ãƒ³["äºŒä¹—"](0), 0)
  æœŸå¾…(ãƒ—ãƒ©ã‚°ã‚¤ãƒ³["äºŒä¹—"](-3), 9)
})

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ()
```

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡ºã—æ–¹ï¼ˆC å´ï¼‰

```c
#include <stdio.h>
#include "hajimu_plugin.h"

static Value å®‰å…¨ãªå‰²ã‚Šç®—(int argc, Value *argv) {
    double é™¤æ•° = argv[1].number;
    if (é™¤æ•° == 0) {
        fprintf(stderr, "[my_plugin] ã‚¨ãƒ©ãƒ¼: ã‚¼ãƒ­é™¤ç®—\n");
        return hajimu_null();  // ç„¡ã‚’è¿”ã—ã¦å‘¼ã³å‡ºã—å…ƒã«é€šçŸ¥
    }
    return hajimu_number(argv[0].number / é™¤æ•°);
}
```

### ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰

```bash
CFLAGS="-g -fsanitize=address" make build-macos
```

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q: `hajimu_plugin.h` ã¯ã©ã“ã‹ã‚‰å–å¾—ã—ã¾ã™ã‹ï¼Ÿ

jp ã®ã‚½ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒª (`jp/include/hajimu_plugin.h`) ã‹ã‚‰å–å¾—ã—ã¦ãã ã•ã„ã€‚
å°†æ¥çš„ã«ã¯ `nihongo install-dev` ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•é…ç½®ã•ã‚Œã‚‹äºˆå®šã§ã™ã€‚

```bash
git clone https://github.com/ReoShiozawa/nihongo jp
# â†’ jp/include/hajimu_plugin.h ã‚’ä½¿ç”¨
```

### Q: `_GNU_SOURCE` ã‚„ `_DARWIN_C_SOURCE` ã¯ã©ã“ã§å®šç¾©ã—ã¾ã™ã‹ï¼Ÿ

`hajimu_plugin.h` ã¯ `_POSIX_C_SOURCE 200809L` ã‚’å®šç¾©ã—ã¾ã™ã€‚
`dladdr` ç­‰ã® GNU æ‹¡å¼µã‚’ä½¿ã†å ´åˆã¯ **ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã‚ˆã‚Šå‰** ã«å®šç¾©ã—ã¦ãã ã•ã„ã€‚

```c
/* Linux: dladdr ã¯ GNU æ‹¡å¼µ */
#ifdef __linux__
  #define _GNU_SOURCE
#endif
/* macOS: _DARWIN_C_SOURCE ã§ dladdr ã‚’æœ‰åŠ¹åŒ– */
#ifdef __APPLE__
  #define _DARWIN_C_SOURCE
#endif

#include "hajimu_plugin.h"
```

### Q: SDL2 / OpenGL ãªã©å¤§ããªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„å ´åˆã¯ï¼Ÿ

Windows ã®å ´åˆã¯ import libï¼ˆ`.dll.a`ï¼‰ã‚’ vendor ã«å«ã‚ã€`-Wl,--allow-shlib-undefined` ãƒ•ãƒ©ã‚°ã§ Linux å‘ã‘ã«ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ï¼ˆSDL2.dll ã¯å®Ÿè¡Œæ™‚ã«è§£æ±ºï¼‰ã€‚è©³ç´°ã¯ [engine_render](https://github.com/ReoShiozawa/hajimu_engine_render) ã®å®Ÿè£…ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

### Q: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰åˆ¥ã® jp ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã›ã¾ã™ã‹ï¼Ÿ

`hajimu_plugin_set_runtime` ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ jp ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å—ã‘å–ã‚Šã€ã¯ã˜ã‚€é–¢æ•°ã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚è©³ç´°ã¯ `hajimu_plugin.h` ã® `HajimuRuntime` æ§‹é€ ä½“ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Q: é–¢æ•°åã«æ—¥æœ¬èªã‚’ä½¿ãˆã¾ã™ã‹ï¼Ÿ

ã¯ã˜ã‚€ã®è­˜åˆ¥å­ã¯ UTF-8 ãªã®ã§æ—¥æœ¬èªã®é–¢æ•°åã‚’ãã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚

```c
static HajimuPluginFunc functions[] = {
    {"å††ã®é¢ç©", å††ã®é¢ç©_fn, 1, 1},  // ã¯ã˜ã‚€å´ã‹ã‚‰ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³["å††ã®é¢ç©"](r) ã§å‘¼ã¹ã‚‹
};
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [REFERENCE.md](REFERENCE.md) â€” ã¯ã˜ã‚€è¨€èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- [TUTORIAL.md](TUTORIAL.md) â€” ã¯ã˜ã‚€å…¥é–€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
- [CONTRIBUTING.md](../CONTRIBUTING.md) â€” ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰
