# 日本語プログラミング言語 リファレンスマニュアル

## 概要

日本語プログラミング言語は、日本語の自然な表現を活かしたプログラミング言語です。
C言語で実装されたインタプリタにより実行されます。

## 目次

1. [基本構文](#基本構文)
2. [データ型](#データ型)
3. [演算子](#演算子)
4. [制御構造](#制御構造)
5. [関数](#関数)
6. [クラス](#クラス)
7. [例外処理](#例外処理)
8. [モジュール](#モジュール)
9. [標準ライブラリ](#標準ライブラリ)
10. [JSON](#json)
11. [HTTP通信](#http通信)
12. [Webhook/HTTPサーバー](#webhookhttpサーバー)
13. [デバッグ](#デバッグ)

---

## 基本構文

### コメント

```
// 一行コメント

/* 
   複数行コメント
*/
```

### 変数と定数

```
変数 名前 = "太郎"        // 変更可能な変数
定数 円周率 = 3.14159     // 変更不可能な定数
```

### 型注釈（オプション）

```
変数 数 は 数値 = 42
変数 名前 は 文字列 = "こんにちは"
```

---

## データ型

| 型 | 説明 | 例 |
|---|---|---|
| 数値 | 浮動小数点数 | `42`, `3.14`, `-17` |
| 文字列 | テキスト | `"こんにちは"` |
| 真偽 | ブール値 | `真`, `偽` |
| 配列 | 順序付きコレクション | `[1, 2, 3]` |
| 辞書 | キーと値のペア | `{"名前": "太郎", "年齢": 25}` |
| 無 | 値なし | `無` |

---

## 演算子

### 算術演算子

| 演算子 | 説明 |
|---|---|
| `+` | 加算 |
| `-` | 減算 |
| `*` | 乗算 |
| `/` | 除算 |
| `%` | 剰余 |
| `**` | べき乗 |

### 比較演算子

| 演算子 | 説明 |
|---|---|
| `==` | 等しい |
| `!=` | 等しくない |
| `<` | 小さい |
| `>` | 大きい |
| `<=` | 以下 |
| `>=` | 以上 |

### 論理演算子

| 演算子 | 説明 |
|---|---|
| `かつ` | 論理積 (AND) |
| `または` | 論理和 (OR) |
| `でない` | 論理否定 (NOT) |

---

## 制御構造

### 条件分岐

```
もし 条件 なら
    // 条件が真の場合
それ以外
    // 条件が偽の場合
終わり
```

### ループ

#### 条件ループ

```
条件 x < 10 の間
    表示(x)
    x = x + 1
終わり
```

#### 範囲ループ

```
i を 1 から 10 繰り返す
    表示(i)
終わり
```

### ループ制御

```
抜ける     // ループを抜ける
続ける     // 次の繰り返しへ
```

---

## 関数

### 関数定義

```
関数 挨拶(名前):
    表示("こんにちは、" + 名前 + "さん")
終わり
```

### 戻り値

```
関数 足し算(a, b):
    戻す a + b
終わり

変数 結果 = 足し算(3, 5)
```

### 型注釈付き関数

```
関数 掛け算(x は 数値, y は 数値) は 数値:
    戻す x * y
終わり
```

---

## クラス

### クラス定義

```
型 人:
    初期化(名前, 年齢):
        自分.名前 = 名前
        自分.年齢 = 年齢
    終わり

    関数 自己紹介():
        表示("私は" + 自分.名前 + "、" + 文字列化(自分.年齢) + "歳です")
    終わり
終わり
```

### インスタンス作成

```
変数 太郎 = 新規 人("太郎", 25)
太郎.自己紹介()
```

### 継承

```
型 学生 継承 人:
    初期化(名前, 年齢, 学校):
        自分.名前 = 名前
        自分.年齢 = 年齢
        自分.学校 = 学校
    終わり

    関数 通学():
        表示(自分.名前 + "は" + 自分.学校 + "に通っています")
    終わり
終わり
```

---

## 例外処理

### 基本構文

```
試行:
    // 例外が発生する可能性のあるコード
    投げる "エラーが発生しました"
捕獲 エラー:
    表示("エラー: " + エラー)
最終:
    // 必ず実行されるコード
終わり
```

---

## モジュール

### モジュールのインポート

```
取り込む "数学.jp"
取り込む "utils/helpers.jp"
```

---

## 標準ライブラリ

### 入出力

| 関数 | 説明 | 例 |
|---|---|---|
| `表示(...)` | 出力 | `表示("こんにちは")` |
| `入力(プロンプト)` | 入力 | `変数 名前 = 入力("名前: ")` |

### コレクション

| 関数 | 説明 |
|---|---|
| `長さ(値)` | 配列・文字列の長さ |
| `追加(配列, 値)` | 配列に要素を追加 |
| `削除(配列, インデックス)` | 要素を削除 |
| `ソート(配列)` | ソート |
| `逆順(配列)` | 逆順 |
| `スライス(配列, 開始, 終了)` | 部分配列 |
| `位置(配列, 値)` | インデックスを取得 |
| `存在(配列, 値)` | 値が存在するか |

### 型変換

| 関数 | 説明 |
|---|---|
| `数値化(値)` | 数値に変換 |
| `文字列化(値)` | 文字列に変換 |

### 数学関数

| 関数 | 説明 |
|---|---|
| `絶対値(数)` | 絶対値 |
| `平方根(数)` | 平方根 |
| `切り捨て(数)` | 切り捨て |
| `切り上げ(数)` | 切り上げ |
| `四捨五入(数)` | 四捨五入 |
| `最大(値...)` | 最大値 |
| `最小(値...)` | 最小値 |
| `乱数()` | 0-1の乱数 |

### 文字列操作

| 関数 | 説明 |
|---|---|
| `分割(文字列, 区切り)` | 文字列を分割 |
| `結合(配列, 区切り)` | 配列を結合 |
| `置換(文字列, 検索, 置換)` | 文字列を置換 |
| `大文字(文字列)` | 大文字に変換 |
| `小文字(文字列)` | 小文字に変換 |
| `空白除去(文字列)` | 前後の空白を除去 |
| `検索(文字列, 検索語)` | 位置を検索 |

### ファイル操作

| 関数 | 説明 |
|---|---|
| `読み込む(パス)` | ファイル読み込み |
| `書き込む(パス, 内容)` | ファイル書き込み |
| `ファイル存在(パス)` | ファイル存在確認 |

### 日時

| 関数 | 説明 |
|---|---|
| `現在時刻()` | Unixタイムスタンプ |
| `日付()` | 現在の日付 (YYYY-MM-DD) |
| `時間()` | 現在の時刻 (HH:MM:SS) |

### 辞書操作

| 関数 | 説明 |
|---|---|
| `キー(辞書)` | キーの配列 |
| `値一覧(辞書)` | 値の配列 |
| `含む(辞書, キー)` | キーの存在確認 |

---

## JSON

JSONの解析と生成ができます。

### JSON化(値)

値をJSON文字列に変換します。

```
変数 データ = {"名前": "太郎", "年齢": 25, "趣味": ["読書", "ゲーム"]}
変数 json = JSON化(データ)
表示(json)  // {"名前":"太郎","年齢":25,"趣味":["読書","ゲーム"]}
```

### JSON解析(文字列)

JSON文字列を値（辞書・配列等）に変換します。

```
変数 結果 = JSON解析("{\"name\":\"Taro\",\"age\":25}")
表示(結果["name"])  // Taro
表示(結果["age"])   // 25
```

---

## HTTP通信

libcurlを使ったHTTPクライアント機能です。全ての関数は結果を辞書で返します。

### レスポンス辞書の構造

| キー | 説明 |
|---|---|
| "状態" | HTTPステータスコード（200, 404等） |
| "本文" | レスポンスボディ（文字列） |
| "ヘッダー" | レスポンスヘッダー（辞書） |
| "エラー" | エラーメッセージ（失敗時） |

### HTTP取得(URL [, ヘッダー])

GETリクエストを送信します。

```
変数 応答 = HTTP取得("https://api.example.com/data")
表示(応答["状態"])   // 200
表示(応答["本文"])   // レスポンスボディ

// JSONレスポンスをパース
変数 データ = JSON解析(応答["本文"])
```

### HTTP送信(URL, ボディ [, ヘッダー])

POSTリクエストを送信します。ボディが辞書・配列の場合、自動的にJSONに変換されます。

```
// 辞書を自動JSON化してPOST
変数 結果 = HTTP送信("https://api.example.com/users", {"名前": "太郎"})

// 文字列をそのままPOST
変数 結果2 = HTTP送信("https://api.example.com/data", "raw body")

// カスタムヘッダー付き
変数 ヘッダー = {"Authorization": "Bearer TOKEN"}
変数 結果3 = HTTP送信("https://api.example.com/data", {"値": 1}, ヘッダー)
```

### HTTP更新(URL, ボディ [, ヘッダー])

PUTリクエストを送信します。使い方はHTTP送信と同じです。

### HTTP削除(URL [, ヘッダー])

DELETEリクエストを送信します。

```
変数 結果 = HTTP削除("https://api.example.com/users/1")
```

### HTTPリクエスト(メソッド, URL [, ボディ, ヘッダー])

任意のHTTPメソッドでリクエストを送信します。

```
変数 結果 = HTTPリクエスト("PATCH", "https://api.example.com/users/1", {"名前": "花子"})
```

### URLエンコード(文字列) / URLデコード(文字列)

URLエンコード/デコードを行います。

```
変数 エンコード済 = URLエンコード("こんにちは 世界")
表示(エンコード済)  // %E3%81%93%E3%82%93...

変数 デコード済 = URLデコード(エンコード済)
表示(デコード済)  // こんにちは 世界
```

---

## Webhook/HTTPサーバー

簡易HTTPサーバーを起動してWebhookを受信できます。

### サーバー起動(ポート [, タイムアウト秒])

指定ポートでHTTPリクエストを1件受信し、リクエスト情報を辞書で返します。
デフォルトタイムアウトは60秒です。

```
// Webhook受信
変数 リクエスト = サーバー起動(8080)
表示(リクエスト["メソッド"])  // POST
表示(リクエスト["パス"])      // /webhook
表示(リクエスト["本文"])      // リクエストボディ
表示(リクエスト["データ"])    // JSON自動パース済み
```

### リクエスト辞書の構造

| キー | 説明 |
|---|---|
| "メソッド" | HTTPメソッド（GET, POST等） |
| "パス" | リクエストパス |
| "本文" | リクエストボディ（文字列） |
| "ヘッダー" | リクエストヘッダー（辞書） |
| "クエリ" | クエリ文字列 |
| "データ" | JSON本文の自動パース結果 |

### 実用例: Webhookリスナー

```
// 無限ループでWebhookを待ち受け
変数 続行 = 真
条件 続行 の間
    変数 リクエスト = サーバー起動(8080, 300)
    変数 メソッド = リクエスト["メソッド"]
    もし メソッド なら
        表示("受信: " + メソッド + " " + リクエスト["パス"])
        表示("データ: " + 文字列化(リクエスト["データ"]))
    終わり
終わり
```

### 実用例: APIクライアント

```
// 外部APIからデータ取得して加工
変数 応答 = HTTP取得("https://jsonplaceholder.typicode.com/posts/1")
もし 応答["状態"] == 200 なら
    変数 記事 = JSON解析(応答["本文"])
    表示("タイトル: " + 記事["title"])
それ以外
    表示("エラー: " + 文字列化(応答["状態"]))
終わり
```

---

## デバッグ

### デバッグモード起動

```bash
nihongo -d プログラム.jp
```

### デバッグコマンド

| キー | 動作 |
|---|---|
| Enter | 次のステップへ進む |
| v | 現在の変数を表示 |
| c | 継続実行（ステップモード終了） |

### その他のオプション

```bash
nihongo -h          # ヘルプ表示
nihongo -v          # バージョン表示
nihongo -t ファイル  # トークン表示
nihongo -a ファイル  # AST表示
```

---

## 実行例

```
// hello.jp
表示("こんにちは、世界！")
```

```bash
$ nihongo hello.jp
こんにちは、世界！
```

---

## バージョン情報

- バージョン: 0.1.0
- 作者: Reo Shiozawa
