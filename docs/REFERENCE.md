# 日本語プログラミング言語 リファレンスマニュアル

## 概要

日本語プログラミング言語は、日本語の自然な表現を活かしたプログラミング言語です。
C言語で実装されたインタプリタにより実行されます。

## 目次

1. [基本構文](#基本構文)
2. [データ型](#データ型)
3. [演算子](#演算子)
4. [制御構造](#制御構造)
5. [関数](#関数)
6. [ラムダ（無名関数）](#ラムダ無名関数)
7. [クラス](#クラス)
8. [例外処理](#例外処理)
9. [モジュール](#モジュール)
10. [標準ライブラリ](#標準ライブラリ)
11. [高階配列関数](#高階配列関数)
12. [正規表現](#正規表現)
13. [システムユーティリティ](#システムユーティリティ)
14. [JSON](#json)
15. [HTTP通信](#http通信)
16. [Webhook/HTTPサーバー](#webhookhttpサーバー)
17. [コマンドライン引数](#コマンドライン引数)
18. [デバッグ](#デバッグ)

---

## 基本構文

### コメント

```
// 一行コメント

/* 
   複数行コメント
*/
```

### 変数と定数

```
変数 名前 = "太郎"        // 変更可能な変数
定数 円周率 = 3.14159     // 変更不可能な定数
```

### 型注釈（オプション）

```
変数 数 は 数値 = 42
変数 名前 は 文字列 = "こんにちは"
```

---

## データ型

| 型 | 説明 | 例 |
|---|---|---|
| 数値 | 浮動小数点数 | `42`, `3.14`, `-17` |
| 文字列 | テキスト | `"こんにちは"` |
| 真偽 | ブール値 | `真`, `偽` |
| 配列 | 順序付きコレクション | `[1, 2, 3]` |
| 辞書 | キーと値のペア | `{"名前": "太郎", "年齢": 25}` |
| 無 | 値なし | `無` |

---

## 演算子

### 算術演算子

| 演算子 | 説明 |
|---|---|
| `+` | 加算 |
| `-` | 減算 |
| `*` | 乗算 |
| `/` | 除算 |
| `%` | 剰余 |
| `**` | べき乗 |

### 比較演算子

| 演算子 | 説明 |
|---|---|
| `==` | 等しい |
| `!=` | 等しくない |
| `<` | 小さい |
| `>` | 大きい |
| `<=` | 以下 |
| `>=` | 以上 |

### 論理演算子

| 演算子 | 説明 |
|---|---|
| `かつ` | 論理積 (AND) |
| `または` | 論理和 (OR) |
| `でない` | 論理否定 (NOT) |

### パイプ演算子

左辺の値を右辺の関数の第一引数として渡します。関数合成に便利です。

```
関数 二倍(数):
    戻す 数 * 2
終わり

関数 足す十(数):
    戻す 数 + 10
終わり

変数 結果 = 5 |> 二倍 |> 足す十  // (5 * 2) + 10 = 20
表示(結果)  // 20
```

### ビット演算関数

ビット単位の演算を行う関数群です。

| 関数 | 説明 | 例 |
|---|---|---|
| `ビット積(a, b)` | ビット論理積 | `ビット積(12, 10)` → 8 |
| `ビット和(a, b)` | ビット論理和 | `ビット和(12, 10)` → 14 |
| `ビット排他(a, b)` | ビット排他的論理和 | `ビット排他(12, 10)` → 6 |
| `ビット否定(a)` | ビット論理否定 | `ビット否定(0)` → -1 |
| `左シフト(a, b)` | 左ビットシフト | `左シフト(1, 4)` → 16 |
| `右シフト(a, b)` | 右ビットシフト | `右シフト(16, 2)` → 4 |

---

## 制御構造

### 条件分岐

```
もし 条件 なら
    // 条件が真の場合
それ以外
    // 条件が偽の場合
終わり
```

### 条件分岐チェーン（else-if）

複数の条件を連続して評価します。`それ以外もし` キーワードを使用します。

```
関数 成績(点数):
    もし 点数 >= 90 なら
        戻す "優"
    それ以外もし 点数 >= 70 なら
        戻す "良"
    それ以外もし 点数 >= 50 なら
        戻す "可"
    それ以外
        戻す "不可"
    終わり
終わり
```

### ループ

#### 条件ループ

```
条件 x < 10 の間
    表示(x)
    x = x + 1
終わり
```

#### 範囲ループ

```
i を 1 から 10 繰り返す
    表示(i)
終わり
```

### ループ制御

```
抜ける     // ループを抜ける
続ける     // 次の繰り返しへ
```

### 各要素ループ（foreach）

配列、文字列、辞書の各要素に対して処理を行います。

```
変数 果物 = ["りんご", "みかん", "ぶどう"]
各 名前 を 果物 の中:
    表示(名前)
終わり
```

#### 文字列の各文字

```
各 文字 を "こんにちは" の中:
    表示(文字)
終わり
```

#### 辞書のキー

```
変数 情報 = {"名前": "太郎", "年齢": "25"}
各 項目 を 情報 の中:
    表示(項目)  // "名前", "年齢"
終わり
```

### 選択文（switch）

値に応じて処理を分岐します。

```
選択 値:
    場合 1:
        表示("一")
    場合 2:
        表示("二")
    場合 3:
        表示("三")
    既定:
        表示("その他")
終わり
```

---

## 関数

### 関数定義

```
関数 挨拶(名前):
    表示("こんにちは、" + 名前 + "さん")
終わり
```

### 戻り値

```
関数 足し算(a, b):
    戻す a + b
終わり

変数 結果 = 足し算(3, 5)
```

### 型注釈付き関数

```
関数 掛け算(x は 数値, y は 数値) は 数値:
    戻す x * y
終わり
```

### デフォルト引数

関数の引数にデフォルト値を指定することで、呼び出し時に引数を省略できます。

```
関数 挨拶(名 = "ゲスト", 接頭 = "こんにちは"):
    戻す 接頭 + "、" + 名 + "！"
終わり

表示(挨拶())                    // "こんにちは、ゲスト！"
表示(挨拶("太郎"))            // "こんにちは、太郎！"
表示(挨拶("太郎", "やあ"))   // "やあ、太郎！"
```

---

## ラムダ（無名関数）

名前のない関数を作成して変数に代入したり、引数として渡すことができます。

### 基本構文

```
変数 二倍 = 関数(x):
    戻す x * 2
終わり

表示(二倍(5))  // 10
```

### 引数として渡す

```
変数 数列 = [1, 2, 3, 4, 5]
変数 結果 = 変換(数列, 関数(x):
    戻す x * 10
終わり)
表示(結果)  // [10, 20, 30, 40, 50]
```

### クロージャ

ラムダは定義時のスコープの変数を捕捉します。

```
関数 掛け算器(倍率):
    戻す 関数(x):
        戻す x * 倍率
    終わり
終わり

変数 三倍 = 掛け算器(3)
表示(三倍(5))  // 15
```

---

## クラス

### クラス定義

```
型 人:
    初期化(名前, 年齢):
        自分.名前 = 名前
        自分.年齢 = 年齢
    終わり

    関数 自己紹介():
        表示("私は" + 自分.名前 + "、" + 文字列化(自分.年齢) + "歳です")
    終わり
終わり
```

### インスタンス作成

```
変数 太郎 = 新規 人("太郎", 25)
太郎.自己紹介()
```

### 継承

```
型 学生 継承 人:
    初期化(名前, 年齢, 学校):
        自分.名前 = 名前
        自分.年齢 = 年齢
        自分.学校 = 学校
    終わり

    関数 通学():
        表示(自分.名前 + "は" + 自分.学校 + "に通っています")
    終わり
終わり
```

---

## 例外処理

### 基本構文

```
試行:
    // 例外が発生する可能性のあるコード
    投げる "エラーが発生しました"
捕獲 エラー:
    表示("エラー: " + エラー)
最終:
    // 必ず実行されるコード
終わり
```

---

## モジュール

### モジュールのインポート

```
取り込む "数学.jp"
取り込む "utils/helpers.jp"
```

---

## 標準ライブラリ

### 入出力

| 関数 | 説明 | 例 |
|---|---|---|
| `表示(...)` | 出力 | `表示("こんにちは")` |
| `入力(プロンプト)` | 入力 | `変数 名前 = 入力("名前: ")` |

### コレクション

| 関数 | 説明 |
|---|---|
| `長さ(値)` | 配列・文字列の長さ |
| `追加(配列, 値)` | 配列に要素を追加 |
| `削除(配列, インデックス)` | 要素を削除 |
| `ソート(配列)` | ソート |
| `逆順(配列)` | 逆順 |
| `スライス(配列, 開始, 終了)` | 部分配列 |
| `位置(配列, 値)` | インデックスを取得 |
| `存在(配列, 値)` | 値が存在するか |

### 型変換

| 関数 | 説明 |
|---|---|
| `数値化(値)` | 数値に変換 |
| `文字列化(値)` | 文字列に変換 |

### 数学関数

| 関数 | 説明 |
|---|---|
| `絶対値(数)` | 絶対値 |
| `平方根(数)` | 平方根 |
| `切り捨て(数)` | 切り捨て |
| `切り上げ(数)` | 切り上げ |
| `四捨五入(数)` | 四捨五入 |
| `最大(値...)` | 最大値 |
| `最小(値...)` | 最小値 |
| `乱数()` | 0-1の乱数 |

### 文字列操作

| 関数 | 説明 |
|---|---|
| `分割(文字列, 区切り)` | 文字列を分割 |
| `結合(配列, 区切り)` | 配列を結合 |
| `置換(文字列, 検索, 置換)` | 文字列を置換 |
| `大文字(文字列)` | 大文字に変換 |
| `小文字(文字列)` | 小文字に変換 |
| `空白除去(文字列)` | 前後の空白を除去 |
| `検索(文字列, 検索語)` | 位置を検索 |

### 文字列補間 (String Interpolation)

文字列内に `{}` を使用して式を埋め込むことができます。

```
変数 名前 = "太郎"
変数 年齢 = 25
表示("{名前}は{年齢}歳")  // "太郎は25歳"
表示("{1 + 2 + 3}")     // "6"
```

### 複数行文字列 (Multi-line String)

`"""..."""` で囲むことで改行を含む文字列を作成できます。

```
変数 複数行 = """これは
複数行の
文字列です"""

表示(複数行)
```

### 範囲関数

様々な範囲を生成します。

| 関数 | 説明 | 例 |
|---|---|---|
| `範囲(終了)` | 0から終了まで | `範囲(5)` → [0,1,2,3,4] |
| `範囲(開始, 終了)` | 開始から終了まで | `範囲(2, 5)` → [2,3,4] |
| `範囲(開始, 終了, ステップ)` | ステップ指定 | `範囲(0, 10, 2)` → [0,2,4,6,8] |

### ファイル操作

| 関数 | 説明 |
|---|---|
| `読み込む(パス)` | ファイル読み込み |
| `書き込む(パス, 内容)` | ファイル書き込み |
| `ファイル存在(パス)` | ファイル存在確認 |

### 日時

| 関数 | 説明 |
|---|---|
| `現在時刻()` | Unixタイムスタンプ |

### 型チェック関数

値の型を判定します。すべて真偽値を返します。

| 関数 | 説明 |
|---|---|
| `数値か(値)` | 数値かどうか判定 |
| `文字列か(値)` | 文字列かどうか判定 |
| `真偽か(値)` | 真偽値かどうか判定 |
| `配列か(値)` | 配列かどうか判定 |
| `辞書か(値)` | 辞書かどうか判定 |
| `関数か(値)` | 関数かどうか判定 |
| `無か(値)` | nullかどうか判定 |
| `日付()` | 現在の日付 (YYYY-MM-DD) |
| `時間()` | 現在の時刻 (HH:MM:SS) |

### 辞書操作

| 関数 | 説明 |
|---|---|
| `キー(辞書)` | キーの配列 |
| `値一覧(辞書)` | 値の配列 |
| `含む(辞書, キー)` | キーの存在確認 |

---

## 高階配列関数

配列の各要素に関数を適用する高階関数です。

### 変換（map）

配列の各要素に関数を適用して新しい配列を返します。

```
変数 数列 = [1, 2, 3, 4, 5]
変数 二倍 = 変換(数列, 関数(x):
    戻す x * 2
終わり)
表示(二倍)  // [2, 4, 6, 8, 10]
```

### 抽出（filter）

条件に合う要素だけを抽出します。

```
変数 偶数 = 抽出([1, 2, 3, 4, 5], 関数(x):
    戻す x % 2 == 0
終わり)
表示(偶数)  // [2, 4]
```

### 集約（reduce）

配列を一つの値に集約します。第3引数は初期値です。

```
変数 合計 = 集約([1, 2, 3, 4, 5], 関数(acc, x):
    戻す acc + x
終わり, 0)
表示(合計)  // 15
```

### 反復（forEach）

配列の各要素に対して関数を実行します（戻り値なし）。

```
反復(["A", "B", "C"], 関数(x):
    表示("要素:", x)
終わり)
```

---

## 正規表現

POSIX拡張正規表現を使用したパターンマッチングです。

### 正規一致(文字列, パターン)

文字列がパターンにマッチするか判定します。

```
表示(正規一致("hello123", "[a-z]+[0-9]+"))  // 真
表示(正規一致("hello", "[0-9]+"))            // 偽
```

### 正規検索(文字列, パターン)

パターンにマッチした部分の配列を返します。最初の要素は全体マッチ、以降はグループです。

```
変数 結果 = 正規検索("電話: 03-1234-5678", "[0-9]+-[0-9]+-[0-9]+")
表示(結果)  // [03-1234-5678]
```

### 正規置換(文字列, パターン, 置換文字列)

パターンにマッチした全ての部分を置換します。

```
変数 結果 = 正規置換("abc 123 def 456", "[0-9]+", "XXX")
表示(結果)  // abc XXX def XXX
```

---

## システムユーティリティ

### 待つ(秒数)

指定秒数だけプログラムを一時停止します（小数可）。

```
待つ(1.5)  // 1.5秒停止
```

### 実行(コマンド)

シェルコマンドを実行し、出力を文字列で返します。

```
変数 結果 = 実行("ls -la")
表示(結果)
```

### 環境変数(名前)

環境変数の値を取得します。

```
変数 ホーム = 環境変数("HOME")
表示(ホーム)  // /Users/username
```

### 環境変数設定(名前, 値)

環境変数を設定します。

```
環境変数設定("MY_VAR", "テスト値")
表示(環境変数("MY_VAR"))  // テスト値
```

### 終了([コード])

プログラムを終了します。終了コードはオプションです（デフォルト: 0）。

```
終了()    // 正常終了
終了(1)   // エラー終了
```

---

## JSON

JSONの解析と生成ができます。

### JSON化(値)

値をJSON文字列に変換します。

```
変数 データ = {"名前": "太郎", "年齢": 25, "趣味": ["読書", "ゲーム"]}
変数 json = JSON化(データ)
表示(json)  // {"名前":"太郎","年齢":25,"趣味":["読書","ゲーム"]}
```

### JSON解析(文字列)

JSON文字列を値（辞書・配列等）に変換します。

```
変数 結果 = JSON解析("{\"name\":\"Taro\",\"age\":25}")
表示(結果["name"])  // Taro
表示(結果["age"])   // 25
```

---

## HTTP通信

libcurlを使ったHTTPクライアント機能です。全ての関数は結果を辞書で返します。

### レスポンス辞書の構造

| キー | 説明 |
|---|---|
| "状態" | HTTPステータスコード（200, 404等） |
| "本文" | レスポンスボディ（文字列） |
| "ヘッダー" | レスポンスヘッダー（辞書） |
| "エラー" | エラーメッセージ（失敗時） |

### HTTP取得(URL [, ヘッダー])

GETリクエストを送信します。

```
変数 応答 = HTTP取得("https://api.example.com/data")
表示(応答["状態"])   // 200
表示(応答["本文"])   // レスポンスボディ

// JSONレスポンスをパース
変数 データ = JSON解析(応答["本文"])
```

### HTTP送信(URL, ボディ [, ヘッダー])

POSTリクエストを送信します。ボディが辞書・配列の場合、自動的にJSONに変換されます。

```
// 辞書を自動JSON化してPOST
変数 結果 = HTTP送信("https://api.example.com/users", {"名前": "太郎"})

// 文字列をそのままPOST
変数 結果2 = HTTP送信("https://api.example.com/data", "raw body")

// カスタムヘッダー付き
変数 ヘッダー = {"Authorization": "Bearer TOKEN"}
変数 結果3 = HTTP送信("https://api.example.com/data", {"値": 1}, ヘッダー)
```

### HTTP更新(URL, ボディ [, ヘッダー])

PUTリクエストを送信します。使い方はHTTP送信と同じです。

### HTTP削除(URL [, ヘッダー])

DELETEリクエストを送信します。

```
変数 結果 = HTTP削除("https://api.example.com/users/1")
```

### HTTPリクエスト(メソッド, URL [, ボディ, ヘッダー])

任意のHTTPメソッドでリクエストを送信します。

```
変数 結果 = HTTPリクエスト("PATCH", "https://api.example.com/users/1", {"名前": "花子"})
```

### URLエンコード(文字列) / URLデコード(文字列)

URLエンコード/デコードを行います。

```
変数 エンコード済 = URLエンコード("こんにちは 世界")
表示(エンコード済)  // %E3%81%93%E3%82%93...

変数 デコード済 = URLデコード(エンコード済)
表示(デコード済)  // こんにちは 世界
```

---

## Webhook/HTTPサーバー

簡易HTTPサーバーを起動してWebhookを受信できます。

### サーバー起動(ポート [, タイムアウト秒])

指定ポートでHTTPリクエストを1件受信し、リクエスト情報を辞書で返します。
デフォルトタイムアウトは60秒です。

```
// Webhook受信
変数 リクエスト = サーバー起動(8080)
表示(リクエスト["メソッド"])  // POST
表示(リクエスト["パス"])      // /webhook
表示(リクエスト["本文"])      // リクエストボディ
表示(リクエスト["データ"])    // JSON自動パース済み
```

### リクエスト辞書の構造

| キー | 説明 |
|---|---|
| "メソッド" | HTTPメソッド（GET, POST等） |
| "パス" | リクエストパス |
| "本文" | リクエストボディ（文字列） |
| "ヘッダー" | リクエストヘッダー（辞書） |
| "クエリ" | クエリ文字列 |
| "データ" | JSON本文の自動パース結果 |

### 実用例: Webhookリスナー

```
// 無限ループでWebhookを待ち受け
変数 続行 = 真
条件 続行 の間
    変数 リクエスト = サーバー起動(8080, 300)
    変数 メソッド = リクエスト["メソッド"]
    もし メソッド なら
        表示("受信: " + メソッド + " " + リクエスト["パス"])
        表示("データ: " + 文字列化(リクエスト["データ"]))
    終わり
終わり
```

### 実用例: APIクライアント

```
// 外部APIからデータ取得して加工
変数 応答 = HTTP取得("https://jsonplaceholder.typicode.com/posts/1")
もし 応答["状態"] == 200 なら
    変数 記事 = JSON解析(応答["本文"])
    表示("タイトル: " + 記事["title"])
それ以外
    表示("エラー: " + 文字列化(応答["状態"]))
終わり
```

---

## コマンドライン引数

スクリプトに渡されたコマンドライン引数は `引数` 配列で取得できます。

```bash
$ nihongo script.jp arg1 arg2 arg3
```

```
// script.jp
表示("引数の数:", 長さ(引数))
各 値 を 引数 の中:
    表示("引数:", 値)
終わり
```

---

## デバッグ

### デバッグモード起動

```bash
nihongo -d プログラム.jp
```

### デバッグコマンド

| キー | 動作 |
|---|---|
| Enter | 次のステップへ進む |
| v | 現在の変数を表示 |
| c | 継続実行（ステップモード終了） |

### その他のオプション

```bash
nihongo -h          # ヘルプ表示
nihongo -v          # バージョン表示
nihongo -t ファイル  # トークン表示
nihongo -a ファイル  # AST表示
```

---

## 実行例

```
// hello.jp
表示("こんにちは、世界！")
```

```bash
$ nihongo hello.jp
こんにちは、世界！
```

---

## バージョン情報

- バージョン: 0.1.0
- 作者: Reo Shiozawa
